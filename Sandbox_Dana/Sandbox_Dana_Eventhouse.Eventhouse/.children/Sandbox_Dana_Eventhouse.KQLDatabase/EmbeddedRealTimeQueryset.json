{
  "queryset": {
    "version": "1.0.0",
    "dataSources": [
      {
        "id": "bd452b62-b73d-4905-aa4c-55b764ed3f2d",
        "clusterUri": "https://trd-nqz7e8kqd22y7fuwu3.z0.kusto.fabric.microsoft.com",
        "type": "Fabric",
        "databaseItemId": "d0b3f8eb-8979-4c44-8e18-42671ca39b7b",
        "databaseItemName": "Sandbox_Dana_Eventhouse"
      }
    ],
    "tabs": [
      {
        "id": "05e44e76-b4cb-4e08-aa3d-b6dce29de344",
        "content": "//***********************************************************************************************************\n// Here are two articles to help you get started with KQL:\n// KQL reference guide - https://aka.ms/KQLguide\n// SQL - KQL conversions - https://aka.ms/sqlcheatsheet\n//***********************************************************************************************************\n\n// simple query - exceeds number of rows\nAutomotive\n\n// Use \"take\" to view a sample number of records in the table and check the data.\nAutomotive\n| take 100\n\n// See how many records are in the table.\nAutomotive\n| count\n\n// Summary table with total number of trips for each unique vendor id\nAutomotive\n| summarize trip_count = count() by vendor_id\n\n// This query returns the number of ingestions per hour in the given table.\nAutomotive\n| summarize IngestionCount = count() by bin(ingestion_time(), 1h)\n\n// Trips with fares over $20 adn return the first 10 rows\nAutomotive\n| where fare_amount > 20\n| project trip_id, pickup_datetime, fare_amount\n| take 10\n\nAutomotive\n| getschema\n\nAutomotive\n| summarize min_dt = min(pickup_datetime), max_dt = max(pickup_datetime)\n\n// Time-based filtering\nAutomotive\n//| where pickup_datetime > ago(30min)  // Filter first - uses time index\n| where pickup_datetime between (datetime(2015-12-01) .. datetime(2015-12-31))\n| project trip_id, vendor_id, pickup_datetime, fare_amount\n| summarize avg_fare = avg(fare_amount) by vendor_id\n\nAutomotive\n| where pickup_datetime between (datetime(2014-01-01) .. datetime(2015-12-31))   // Time filter first - eliminates most data\n| where vendor_id == \"VTS\"           // Specific vendor - eliminates some data  \n| where fare_amount > 0              // Value filter - eliminates least data\n| summarize trip_count = count()\n\nAutomotive\n| project trip_id, pickup_datetime, fare_amount  // Select columns early\n| where pickup_datetime between (datetime(2014-01-01) .. datetime(2015-12-31))  // Then filter\n| summarize avg_fare = avg(fare_amount)\n\nAutomotive\n| where pickup_datetime between (datetime(2014-01-01) .. datetime(2015-12-31))\n| summarize trip_count = count() by trip_id, vendor_id\n| limit 1000  // Limit results for exploration\n\n// Playing with materialized views even though the data isn't updating\n.create materialized-view TripsByVendor on table Automotive\n{\n    Automotive\n    | summarize trips = count(), avg_fare = avg(fare_amount), total_revenue = sum(fare_amount)\n    by vendor_id, pickup_date = format_datetime(pickup_datetime, \"yyyy-MM-dd\") // creates date as a string\n}\n\n.create materialized-view TripsByVendor\non table Automotive\n{\n    Automotive\n    | summarize trips = count(), avg_fare = avg(fare_amount), total_revenue = sum(fare_amount)\n      by pickup_date = bin(pickup_datetime, 1d), vendor_id // does not create date as a string\n}\n\n.alter materialized-view TripsByVendor populate\n\n.show materialized-view ['TripsByVendor']\n\nTripsByVendor\n| summarize min_dt = min(todatetime(pickup_date)), max_dt = max(todatetime(pickup_date)), row_count = count()\n\n// Playing with functions\n\n.create-or-alter function trips_by_min_passenger_count(num_passengers:long)\n{\n    Automotive\n    | where passenger_count >= num_passengers \n    | project trip_id, pickup_datetime\n}\n\ntrips_by_min_passenger_count(3)\n| take 10\n\n",
        "title": "Tab",
        "dataSourceId": "bd452b62-b73d-4905-aa4c-55b764ed3f2d"
      }
    ]
  }
}